<!doctype html>
<html lang="zh-CN">
 <head>
  <meta charset="utf-8">
  <link rel="canonical" href="https://blog.csdn.net/zero112535/article/details/107440768">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="report" content="{&quot;pid&quot;: &quot;blog&quot;, &quot;spm&quot;:&quot;1001.2101&quot;}">
  <meta name="referrer" content="always">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <link rel="alternate" media="handheld" href="#">
  <meta name="shenma-site-verification" content="5a59773ab8077d4a62bf469ab966a63b_1497598848">
  <meta name="applicable-device" content="pc">
  <link href="http://toolman.ddnsfree.com:8585/cn/csdnimg/g/static/logo/favicon32.ico" rel="shortcut icon" type="image/x-icon">
  <title>Kaggle经典项目——房价预测_kaggle房价预测-CSDN博客</title>
  <meta name="keywords" content="kaggle房价预测">
  <meta name="csdn-baidu-search" content="{&quot;autorun&quot;:true,&quot;install&quot;:true,&quot;keyword&quot;:&quot;kaggle房价预测&quot;}">
  <meta name="description" content="文章浏览阅读4.5w次，点赞146次，收藏892次。本文介绍了kaggle房价预测项目，包括问题陈述、数据处理和模型预测三个部分。在数据处理阶段，作者进行了数据探索、异常值处理、缺失值填充和特征工程等操作。在模型预测环节，使用了多种回归模型进行训练和评估，并通过Stacking和Blending提升预测性能。最终在kaggle排行榜上取得了较好的成绩。">
  <link rel="stylesheet" type="text/css" href="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blogv2/dist/pc/css/detail_enter-2fe393ff58.min.css">
  <link rel="stylesheet" type="text/css" href="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blogv2/dist/pc/themesSkin/skin3-template/skin3-template-762f7595fd.min.css">
  <meta name="toolbar" content="{&quot;type&quot;:&quot;0&quot;,&quot;fixModel&quot;:&quot;1&quot;}">
  <link rel="stylesheet" type="text/css" href="http://toolman.ddnsfree.com:8585/cn/csdnimg/public/sandalstrap/1.4/css/sandalstrap.min.css">
  <style>
        .MathJax, .MathJax_Message, .MathJax_Preview{
            display: none
        }
    </style>
 </head>
 <body class="nodata " style="">
  <link rel="stylesheet" href="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blogv2/dist/pc/css/blog_code-01256533b5.min.css">
  <link rel="stylesheet" href="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blogv2/dist/mdeditor/css/editerView/chart-3456820cac.css">
  <link rel="stylesheet" href="http://toolman.ddnsfree.com:8585/cn/csdnimg/g/lib/swiper/6.0.4/css/swiper.css"><div class="main_father clearfix d-flex justify-content-center mainfather-concision" style="height:100%;"><div class="container clearfix container-concision" id="mainBox">
    <main>
     <div class="blog-content-box"><div class="article-header-box"><div class="article-header"><div class="article-title-box">
         <h1 class="title-article" id="articleContentId">Kaggle经典项目——房价预测</h1></div><div class="article-info-box"><div class="up-time">
          最新推荐文章于&nbsp;2021-10-04 16:19:16&nbsp;发布</div><div class="article-bar-top"><img class="article-type-img" src="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blogv2/dist/pc/img/original.png" alt=""><div class="bar-content"><img class="article-vip-img-new" src="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blogv2/dist/pc/img/identityVipNew.png" alt=""> <a class="follow-nickName " href="https://blog.csdn.net/zero112535" target="_blank" rel="noopener" title="Harold_Ran">Harold_Ran</a> <img class="article-time-img article-heard-img" src="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blogv2/dist/pc/img/newCurrentTime2.png" alt=""> <span class="time blog-postTime" data-time="2020-07-19 18:35:38">最新推荐文章于&nbsp;2021-10-04 16:19:16&nbsp;发布</span>
           <div class="read-count-box"><img class="article-read-img article-heard-img" src="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blogv2/dist/pc/img/articleReadEyes2.png" alt=""> <span class="read-count">阅读量4.5w</span> <a id="blog_detail_zk_collection" class="un-collection" data-report-click="{&quot;mod&quot;:&quot;popu_823&quot;,&quot;spm&quot;:&quot;1001.2101.3001.4232&quot;,&quot;ab&quot;:&quot;new&quot;}"> <img class="article-collect-img article-heard-img un-collect-status isdefault" style="display:inline-block" src="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blogv2/dist/pc/img/tobarCollect2.png" alt=""> <img class="article-collect-img article-heard-img collect-status isactive" style="display:none" src="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blogv2/dist/pc/img/tobarCollectionActive2.png" alt=""> <span class="name">收藏</span> <span class="get-collection"> 892 </span> </a>
            <div class="read-count-box is-like"><img class="article-read-img article-heard-img" style="display:none" id="is-like-imgactive-new" src="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blogv2/dist/pc/img/newHeart2023Active.png" alt=""> <img class="article-read-img article-heard-img" style="display:block" id="is-like-img-new" src="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blogv2/dist/pc/img/newHeart2023Black.png" alt=""> <span class="read-count" id="blog-digg-num">点赞数 146 </span></div></div></div></div><div class="blog-tags-box"><div class="tags-box artic-tag-box"><span class="label">分类专栏：</span> <a class="tag-link" href="https://blog.csdn.net/zero112535/category_10213049.html" target="_blank" rel="noopener">项目学习</a> <span class="label">文章标签：</span> <a rel="nofollow" data-report-query="spm=1001.2101.3001.4223" data-report-click="{&quot;mod&quot;:&quot;popu_626&quot;,&quot;spm&quot;:&quot;1001.2101.3001.4223&quot;,&quot;strategy&quot;:&quot;数据挖掘&quot;,&quot;ab&quot;:&quot;new&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;数据挖掘\&quot;}&quot;}" data-report-view="{&quot;mod&quot;:&quot;popu_626&quot;,&quot;spm&quot;:&quot;1001.2101.3001.4223&quot;,&quot;strategy&quot;:&quot;数据挖掘&quot;,&quot;ab&quot;:&quot;new&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;数据挖掘\&quot;}&quot;}" class="tag-link" href="https://so.csdn.net/so/search/s.do?q=%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98&amp;t=all&amp;o=vip&amp;s=&amp;l=&amp;f=&amp;viparticle=&amp;from_tracking_code=tag_word&amp;from_code=app_blog_art" target="_blank">数据挖掘</a> <a rel="nofollow" data-report-query="spm=1001.2101.3001.4223" data-report-click="{&quot;mod&quot;:&quot;popu_626&quot;,&quot;spm&quot;:&quot;1001.2101.3001.4223&quot;,&quot;strategy&quot;:&quot;kaggle&quot;,&quot;ab&quot;:&quot;new&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;kaggle\&quot;}&quot;}" data-report-view="{&quot;mod&quot;:&quot;popu_626&quot;,&quot;spm&quot;:&quot;1001.2101.3001.4223&quot;,&quot;strategy&quot;:&quot;kaggle&quot;,&quot;ab&quot;:&quot;new&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;kaggle\&quot;}&quot;}" class="tag-link" href="https://so.csdn.net/so/search/s.do?q=kaggle&amp;t=all&amp;o=vip&amp;s=&amp;l=&amp;f=&amp;viparticle=&amp;from_tracking_code=tag_word&amp;from_code=app_blog_art" target="_blank">kaggle</a> <a rel="nofollow" data-report-query="spm=1001.2101.3001.4223" data-report-click="{&quot;mod&quot;:&quot;popu_626&quot;,&quot;spm&quot;:&quot;1001.2101.3001.4223&quot;,&quot;strategy&quot;:&quot;机器学习&quot;,&quot;ab&quot;:&quot;new&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;机器学习\&quot;}&quot;}" data-report-view="{&quot;mod&quot;:&quot;popu_626&quot;,&quot;spm&quot;:&quot;1001.2101.3001.4223&quot;,&quot;strategy&quot;:&quot;机器学习&quot;,&quot;ab&quot;:&quot;new&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;机器学习\&quot;}&quot;}" class="tag-link" href="https://so.csdn.net/so/search/s.do?q=%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0&amp;t=all&amp;o=vip&amp;s=&amp;l=&amp;f=&amp;viparticle=&amp;from_tracking_code=tag_word&amp;from_code=app_blog_art" target="_blank">机器学习</a></div></div><div class="slide-content-box"><div class="article-copyright"><div class="creativecommons">
            版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 BY-SA </a>版权协议，转载请附上原文出处链接和本声明。</div><div class="article-source-link">
            本文链接：<a href="https://blog.csdn.net/zero112535/article/details/107440768" target="_blank">https://blog.csdn.net/zero112535/article/details/107440768</a></div></div></div><div class="operating"><a class="href-article-edit slide-toggle">版权</a></div></div></div></div><div id="blogHuaweiyunAdvert"></div><div class="ai-abstract-box"><div class="ai-abstract"><div class="abstract-content"><img class="lock-img" src="http://toolman.ddnsfree.com:8585/cn/csdnimg/img-home/images/20240711042549.png" alt=""> 本文介绍了kaggle房价预测项目，包括问题陈述、数据处理和模型预测三个部分。在数据处理阶段，作者进行了数据探索、异常值处理、缺失值填充和特征工程等操作。在模型预测环节，使用了多种回归模型进行训练和评估，并通过Stacking和Blending提升预测性能。最终在kaggle排行榜上取得了较好的成绩。</div> <span>摘要由CSDN通过智能技术生成</span></div></div>
      <article class="baidu_pl"><div id="article_content" class="article_content clearfix">
        <link rel="stylesheet" href="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blogv2/dist/mdeditor/css/editerView/kdoc_html_views-1a98987dfd.css">
        <link rel="stylesheet" href="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-704d5b9767.css"><div id="content_views" class="markdown_views prism-atom-one-light">
         <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
         </svg>
         <p>写在前面：<br> 这篇文章旨在梳理kaggle回归问题的一个基本流程。博主只是一个数据分析刚入门的新手，有些错漏之处还请批评指正。很遗憾这个项目最后提交的Private Score只达到了排行榜的TOP13%，我目前也还没有更好的方法去进一步提高分数，不过整个项目做完之后对kaggle回归预测项目的解题思路有了一套比较完整清楚的认识，总结出来和大家分享，欢迎共同探讨。<br> 完整的代码放在github：<a href="https://github.com/Harold-Ran/Kaggle-House-Price-Forecast">kaggle房价预测完整代码</a></p>
         <h2><a id="1_3"></a>1.项目背景</h2>
         <h3><a id="_4"></a>问题陈述</h3>
         <p>房价预测是kaggle的一个经典Data Science项目，作为数据分析的新手，这是一个很好的入门练习项目。<br> 任务很明确，就是要根据给出的79个特征，预测对应的房价，这些特征包括房子的类型、临街宽度、各层的面积等等。<br> 数据可以在以下链接下载：<br> <a href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques" rel="nofollow">Kaggle: House Price</a><br> 给出的数据包括四份文件：<br> · ‘train.csv’：训练数据<br> · ‘test.csv’：测试数据<br> · ‘data_description.txt’：说明各个特征的文档<br> · ‘sample_submission.csv’：预测结果提交的示例</p>
         <h3><a id="_14"></a>评价指标</h3>
         <p>Kaggle给出的评价指标是回归问题中常用的均方误差（RMSE）：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> R M S E = 1 n ∑ i = 1 n ( y i − y i ^ ) 2 RMSE = \sqrt{\frac{1}{n}\displaystyle\sum_{i=1}^n(y_i-\hat{y_i})^2} </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="mord mathdefault" style="margin-right: 0.05764em;">S</span><span class="mord mathdefault" style="margin-right: 0.05764em;">E</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.15682em; vertical-align: -1.27767em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.87915em;"><span class="svg-align" style="top: -5.11682em;"><span class="pstrut" style="height: 5.11682em;"></span><span class="mord" style="padding-left: 1.056em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">n</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">^</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.83915em;"><span class="pstrut" style="height: 5.11682em;"></span><span class="hide-tail" style="min-width: 0.742em; height: 3.19682em;">
                     <svg width="400em" height="3.196816em" viewbox="0 0 400000 3196" preserveaspectratio="xMinYMin slice"><path d="M702 80H400000v40H742v3062l-4 4-4 4c-.667.7
-2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1h-12l-28-84c-16.667-52-96.667
-294.333-240-727l-212 -643 -85 170c-4-3.333-8.333-7.667-13 -13l-13-13l77-155
 77-156c66 199.333 139 419.667 219 661 l218 661zM702 80H400000v40H742z"></path>
                     </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span></span></span></span></span></span></p>
         <h2><a id="2_17"></a>2.数据处理</h2>
         <h3><a id="_18"></a>数据探索</h3>
         <p>俗话说，知己知彼 百战不殆。拿到数据之后要做的第一件事就是了解你手中的这份数据。</p>
         <h4><a id="_20"></a>导入所需的库</h4>
         <p>首先导入必要的库：</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
pd<span class="token punctuation">.</span>set_option<span class="token punctuation">(</span><span class="token string">'display.float_format'</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token string">'{:.2f}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
color <span class="token operator">=</span> sns<span class="token punctuation">.</span>color_palette<span class="token punctuation">(</span><span class="token punctuation">)</span>
sns<span class="token punctuation">.</span>set_style<span class="token punctuation">(</span><span class="token string">'darkgrid'</span><span class="token punctuation">)</span>

<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token operator">%</span>matplotlib inline

<span class="token keyword">from</span> scipy <span class="token keyword">import</span> stats
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>special <span class="token keyword">import</span> boxcox1p
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>stats <span class="token keyword">import</span> norm<span class="token punctuation">,</span> skew

<span class="token comment">#忽略警告</span>
<span class="token keyword">import</span> warnings
<span class="token keyword">def</span> <span class="token function">ignore_warn</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
warnings<span class="token punctuation">.</span>warn <span class="token operator">=</span> ignore_warn

<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> LabelEncoder
</code></pre>
         <h4><a id="_48"></a>查看数据集</h4>
         <p>先来看看训练集：</p>
         <pre class="set-code-show"><code class="prism language-python">train <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'train.csv'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The shape of training data:'</span><span class="token punctuation">,</span> train<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
train<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
         <blockquote>
          <p>The shape of training data: (1460, 81)</p>
         </blockquote>
         <p><img src="http://toolman.ddnsfree.com:8585/cn/csdnimg/i-blog/blog_migrate/e775b7b3222ff5c5b83e202abe8b9add.png" alt="部分训练数据"><br> 可以看到训练数据的大小是1460*81，也就是说训练数据总共有1460条，81列，其中最后一列是我们的预测目标：SalePrice。（训练数据的表格因为太长，我这里没有全部放出来）<br> 再来看看测试数据：</p>
         <pre class="set-code-show"><code class="prism language-python">test <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'test.csv'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The shape of testing data:'</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
test<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
         <blockquote>
          <p>The shape of testing data: (1459, 80)</p>
         </blockquote>
         <p><img src="http://toolman.ddnsfree.com:8585/cn/csdnimg/i-blog/blog_migrate/b0e67d547d6c752ae8655552c921007e.png#pic_center" alt="部分测试数据"></p>
         <p>测试数据一共是1459条，80列。<br> 注意到Id这一列是直接从1顺次排到2919的，训练数据取的是1 ~ 1460，测试数据取的是1461 ~ 2919，说明Id和房价没有任何关系，所以直接去掉这一列：</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#ID列没有用，直接删掉</span>
train<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'Id'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
test<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'Id'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The shape of training data:'</span><span class="token punctuation">,</span> train<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The shape of testing data:'</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre>
         <blockquote>
          <p>The shape of training data: (1460, 80)<br> The shape of testing data: (1459, 79)</p>
         </blockquote>
         <p>去掉之后训练数据大小是1460<em>80，测试数据是1459</em>79。</p>
         <h4><a id="_88"></a>目标值分析</h4>
         <p>要了解整个数据，我们首先得了解要预测的目标值，包括两方面：目标值的分布、其他特征与目标值的关系。<br> 我们先来看看目标值的分布：</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#绘制目标值分布</span>
sns<span class="token punctuation">.</span>distplot<span class="token punctuation">(</span>train<span class="token punctuation">[</span><span class="token string">'SalePrice'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
         <p><img src="http://toolman.ddnsfree.com:8585/cn/csdnimg/i-blog/blog_migrate/e84f5c8b910128eb6962c5c6ae65e9c7.png#pic_center" alt="SalePrice分布直方图"><br> 明显的右偏分布，这就意味着我们之后要对目标值做一些处理，因为回归模型在正态分布的数据集上表现更好。<br> 再看看目标值的统计值：</p>
         <pre class="set-code-show"><code class="prism language-python">train<span class="token punctuation">[</span><span class="token string">'SalePrice'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
         <blockquote>
          <p>count 1460.00<br> mean 180921.20<br> std 79442.50<br> min 34900.00<br> 25% 129975.00<br> 50% 163000.00<br> 75% 214000.00<br> max 755000.00<br> Name: SalePrice, dtype: float64</p>
         </blockquote>
         <p>最大值和均值之间差距比较大，可能会存在异常值。<br> 这里有一个小trick：把类别特征和数字特征分离开来，在处理的时候会比较方便。</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#分离数字特征和类别特征</span>
num_features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
cate_features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> col <span class="token keyword">in</span> test<span class="token punctuation">.</span>columns<span class="token punctuation">:</span>
    <span class="token keyword">if</span> test<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>dtype <span class="token operator">==</span> <span class="token string">'object'</span><span class="token punctuation">:</span>
        cate_features<span class="token punctuation">.</span>append<span class="token punctuation">(</span>col<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        num_features<span class="token punctuation">.</span>append<span class="token punctuation">(</span>col<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'number of numeric features:'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num_features<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'number of categorical features:'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>cate_features<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
         <blockquote>
          <p>number of numeric features: 36<br> number of categorical features: 43</p>
         </blockquote>
         <p>总共有36个数字特征，43个类别特征。<br> 查看目标值和数字特征之间的关系（查看数字特征通常采用散点图）：</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#查看数字特征与目标值的关系</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplots_adjust<span class="token punctuation">(</span>hspace<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> wspace<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> feature <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>num_features<span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
    sns<span class="token punctuation">.</span>scatterplot<span class="token punctuation">(</span>x<span class="token operator">=</span>feature<span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">'SalePrice'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>train<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'SalePrice'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
         <p><img src="http://toolman.ddnsfree.com:8585/cn/csdnimg/i-blog/blog_migrate/91fd972b4299aaac24b80288988ff40c.png#pic_center" alt="数字特征与目标值的关系"><br> 可以看到，‘TotalBsmtSF’、'GrLiveArea’与目标值之间有明显的线性关系，那么这两个值对目标值的预测应该会有很大的帮助，这就是我们要重点关注的特征。<br> 在类别特征中，凭直觉来看，'Neighborhood’这个特征应该是很重要的，房子的房价往往和周围的房价是差不多的，为了验证这个想法，我们来看看不同类型的’Neighborhood’房价的分布情况（查看类别特征通常采用箱线图）：</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#查看‘Neighborhood’与目标值的关系</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sns<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">'Neighborhood'</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">'SalePrice'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>train<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Neighborhood'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'SalePrice'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>rotation<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
</code></pre>
         <p><img src="http://toolman.ddnsfree.com:8585/cn/csdnimg/i-blog/blog_migrate/12d17aeed80df79fc38d32a0f334462d.png#pic_center" alt="不同Neighborhood房价分布"><br> 不同的’Neighborhood’类型房价的分布区间是明显不同的，这验证了我们的猜想。<br> 在逛kaggle的kernel的时候，有人提到不同年份的房价会不会跟通胀有关系，我觉得这是个很有意思的想法，于是用同样的方法来看一下出售年份’YrSold’和房价的关系：</p>
         <pre class="set-code-show"><code class="prism language-python">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sns<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">'YrSold'</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">'SalePrice'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>train<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'YrSold'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'SalePrice'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>rotation<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
</code></pre>
         <p><img src="http://toolman.ddnsfree.com:8585/cn/csdnimg/i-blog/blog_migrate/b73ed11758f26096838ce64d421240f6.png#pic_center" alt="出售年份与房价的关系"><br> 看起来不同的出售年份房价的分布状态差不多，所以我们就不考虑把各个年份的通胀数据加进来了。</p>
         <h4><a id="_172"></a>多变量分析</h4>
         <p>单个特征分析完了，我们来看看所有特征之间的相关关系：</p>
         <pre class="set-code-show"><code class="prism language-python">corrs <span class="token operator">=</span> train<span class="token punctuation">.</span>corr<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sns<span class="token punctuation">.</span>heatmap<span class="token punctuation">(</span>corrs<span class="token punctuation">)</span>
</code></pre>
         <p><img src="http://toolman.ddnsfree.com:8585/cn/csdnimg/i-blog/blog_migrate/9a56d67084484542e3bbffcfc40631f0.png#pic_center" alt="所有特征相关度热图"><br> 由于特征比较多，我们可以取与目标值相关度最高的十个特征再次绘制相关度热图：</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#分析与目标值相关度最高的十个变量</span>
cols_10 <span class="token operator">=</span> corrs<span class="token punctuation">.</span>nlargest<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'SalePrice'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'SalePrice'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index
corrs_10 <span class="token operator">=</span> train<span class="token punctuation">[</span>cols_10<span class="token punctuation">]</span><span class="token punctuation">.</span>corr<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sns<span class="token punctuation">.</span>heatmap<span class="token punctuation">(</span>corrs_10<span class="token punctuation">,</span> annot<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>
         <p><img src="http://toolman.ddnsfree.com:8585/cn/csdnimg/i-blog/blog_migrate/0d67e37391228b2466e1fc0bb412b633.png#pic_center" alt="与目标值相关度最高的十个特征"><br> 并绘制这十个特征两两之间的散点图：</p>
         <pre class="set-code-show"><code class="prism language-python">g <span class="token operator">=</span> sns<span class="token punctuation">.</span>PairGrid<span class="token punctuation">(</span>train<span class="token punctuation">[</span>cols_10<span class="token punctuation">]</span><span class="token punctuation">)</span>
g<span class="token punctuation">.</span>map_diag<span class="token punctuation">(</span>plt<span class="token punctuation">.</span>hist<span class="token punctuation">)</span>
g<span class="token punctuation">.</span>map_offdiag<span class="token punctuation">(</span>plt<span class="token punctuation">.</span>scatter<span class="token punctuation">)</span>
</code></pre>
         <p><img src="http://toolman.ddnsfree.com:8585/cn/csdnimg/i-blog/blog_migrate/943d6f9d97ecf5bf7ca8ddf291c76b0a.png#pic_center" alt="十个特征散点图"><br> 到这里，对数据的探索就基本完成了。目前可以看出，‘TotalBsmtSF’、‘GrLiveArea’、'Neighborhood’这几个是我们要重点关注的特征。</p>
         <h3><a id="_200"></a>特征工程</h3>
         <h4><a id="_201"></a>异常值处理</h4>
         <p>观察’TotalBsmtSF’、'GrLiveArea’与目标值的散点图，可以看到存在异常值：</p>
         <pre class="set-code-show"><code class="prism language-python">sns<span class="token punctuation">.</span>scatterplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">'TotalBsmtSF'</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">'SalePrice'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>train<span class="token punctuation">)</span>
</code></pre>
         <p><img src="http://toolman.ddnsfree.com:8585/cn/csdnimg/i-blog/blog_migrate/578d550ec493bc3fcda39ecc0c8df7ee.png#pic_center" alt="TotalBsmtSF-SalePrice散点图"><br> ‘TotalBsmtSF’-'SalePrice’基本呈线性关系，右下角有一个明显的异常值。我们去掉这个异常值，并重新绘图检查以下：</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#处理掉右下的明显异常值</span>
train <span class="token operator">=</span> train<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>train<span class="token punctuation">[</span><span class="token punctuation">(</span>train<span class="token punctuation">[</span><span class="token string">'TotalBsmtSF'</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">6000</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>train<span class="token punctuation">[</span><span class="token string">'SalePrice'</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">200000</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">)</span>

sns<span class="token punctuation">.</span>scatterplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">'TotalBsmtSF'</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">'SalePrice'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>train<span class="token punctuation">)</span>
</code></pre>
         <p><img src="http://toolman.ddnsfree.com:8585/cn/csdnimg/i-blog/blog_migrate/926a2450d0032e4aab5378cea145ddfd.png#pic_center" alt="去掉异常值后的TotalBsmtSF"><br> 此时异常值已经没有了。<br> 对’GrLiveArea’进行同样的处理：</p>
         <pre class="set-code-show"><code class="prism language-python">sns<span class="token punctuation">.</span>scatterplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">'GrLivArea'</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">'SalePrice'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>train<span class="token punctuation">)</span>
</code></pre>
         <p><img src="http://toolman.ddnsfree.com:8585/cn/csdnimg/i-blog/blog_migrate/b11a8510efe4165b1a0e35fc208be1c6.png#pic_center" alt="GrLiveArea-SalePrice散点图"><br> 也是右下角存在异常值，同样删去：</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#处理掉右下的异常值</span>
train <span class="token operator">=</span> train<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>train<span class="token punctuation">[</span><span class="token punctuation">(</span>train<span class="token punctuation">[</span><span class="token string">'GrLivArea'</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">4000</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>train<span class="token punctuation">[</span><span class="token string">'SalePrice'</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">200000</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">)</span>

sns<span class="token punctuation">.</span>scatterplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">'GrLivArea'</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">'SalePrice'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>train<span class="token punctuation">)</span>
</code></pre>
         <h4><a id="_232"></a>缺失值处理</h4>
         <p>注意不能把训练数据和测试数据连接在一起处理，会造成数据泄露，应该分步处理，先处理训练数据，再同样地处理测试数据。<br> 先查看训练数据各个特征中的缺失值个数：</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#查看训练集中各特征的数据缺失个数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The shape of training data:'</span><span class="token punctuation">,</span> train<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
train_missing <span class="token operator">=</span> train<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
train_missing <span class="token operator">=</span> train_missing<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>train_missing<span class="token punctuation">[</span>train_missing<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
train_missing
</code></pre>
         <blockquote>
          <p>The shape of training data: (1458, 80)<br> PoolQC 1452<br> MiscFeature 1404<br> Alley 1367<br> Fence 1177<br> FireplaceQu 690<br> LotFrontage 259<br> GarageYrBlt 81<br> GarageType 81<br> GarageFinish 81<br> GarageQual 81<br> GarageCond 81<br> BsmtFinType2 38<br> BsmtExposure 38<br> BsmtFinType1 37<br> BsmtCond 37<br> BsmtQual 37<br> MasVnrArea 8<br> MasVnrType 8<br> Electrical 1<br> dtype: int64</p>
         </blockquote>
         <p>再查看测试数据各个特征中的缺失值个数：</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#查看测试集中各特征的数据缺失个数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The shape of testing data:'</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
test_missing <span class="token operator">=</span> test<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
test_missing <span class="token operator">=</span> test_missing<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>test_missing<span class="token punctuation">[</span>test_missing<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
test_missing
</code></pre>
         <blockquote>
          <p>The shape of testing data: (1459, 79)<br> PoolQC 1456<br> MiscFeature 1408<br> Alley 1352<br> Fence 1169<br> FireplaceQu 730<br> LotFrontage 227<br> GarageYrBlt 78<br> GarageCond 78<br> GarageQual 78<br> GarageFinish 78<br> GarageType 76<br> BsmtCond 45<br> BsmtExposure 44<br> BsmtQual 44<br> BsmtFinType1 42<br> BsmtFinType2 42<br> MasVnrType 16<br> MasVnrArea 15<br> MSZoning 4<br> BsmtFullBath 2<br> BsmtHalfBath 2<br> Utilities 2<br> Functional 2<br> Exterior2nd 1<br> Exterior1st 1<br> SaleType 1<br> BsmtFinSF1 1<br> BsmtFinSF2 1<br> BsmtUnfSF 1<br> KitchenQual 1<br> GarageCars 1<br> GarageArea 1<br> TotalBsmtSF 1<br> dtype: int64</p>
         </blockquote>
         <p>测试数据中存在缺失值的特征会更多一些。</p>
         <h5><a id="_313"></a>类别特征处理</h5>
         <p>先来处理类别特征，这些特征缺失值的处理有以下几种方法：</p>
         <h6><a id="_None_315"></a>· 补充为’None’</h6>
         <p>根据特征说明文档，以下特征缺失代表没有，所以直接补充为’None’就可以了：</p>
         <pre class="set-code-show"><code class="prism language-python">none_lists <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'PoolQC'</span><span class="token punctuation">,</span> <span class="token string">'MiscFeature'</span><span class="token punctuation">,</span> <span class="token string">'Alley'</span><span class="token punctuation">,</span> <span class="token string">'Fence'</span><span class="token punctuation">,</span> <span class="token string">'FireplaceQu'</span><span class="token punctuation">,</span> <span class="token string">'GarageType'</span><span class="token punctuation">,</span> <span class="token string">'GarageFinish'</span><span class="token punctuation">,</span> <span class="token string">'GarageQual'</span><span class="token punctuation">,</span> <span class="token string">'GarageCond'</span><span class="token punctuation">,</span> <span class="token string">'BsmtFinType1'</span><span class="token punctuation">,</span>
              <span class="token string">'BsmtFinType2'</span><span class="token punctuation">,</span> <span class="token string">'BsmtCond'</span><span class="token punctuation">,</span> <span class="token string">'BsmtExposure'</span><span class="token punctuation">,</span> <span class="token string">'BsmtQual'</span><span class="token punctuation">,</span> <span class="token string">'MasVnrType'</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> col <span class="token keyword">in</span> none_lists<span class="token punctuation">:</span>
    train<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> train<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">'None'</span><span class="token punctuation">)</span>
    test<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> test<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">'None'</span><span class="token punctuation">)</span>
</code></pre>
         <h6><a id="__325"></a>· 补充出现频率最高的一类</h6>
         <p>根据文档，以下特征缺失不代表没有，只是说明数据丢失了，所以对缺失值补充该特征中出现次数最多的值：</p>
         <pre class="set-code-show"><code class="prism language-python">most_lists <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'MSZoning'</span><span class="token punctuation">,</span> <span class="token string">'Exterior1st'</span><span class="token punctuation">,</span> <span class="token string">'Exterior2nd'</span><span class="token punctuation">,</span> <span class="token string">'SaleType'</span><span class="token punctuation">,</span> <span class="token string">'KitchenQual'</span><span class="token punctuation">,</span> <span class="token string">'Electrical'</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> col <span class="token keyword">in</span> most_lists<span class="token punctuation">:</span>
    train<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> train<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>train<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>mode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    test<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> test<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>train<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>mode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment">#注意这里补充的是训练集中出现最多的类别</span>
</code></pre>
         <p>注意处理测试数据时，我们仍然是向其中补充和训练数据一样的值，而不用测试数据中出现次数最多的值。<br> 不同的是，‘Functional’这个特征，文档中说缺失值都看作是’Typ’，所以直接填入’Typ’。另外，‘Utilities’在训练集中全为’AllPub’，除了两个’NoSeWa’，而在测试集中有两处缺失，其他全为’AllPub’，说明这个特征对测试集的房价预测没有帮助，所以删掉该特征：</p>
         <pre class="set-code-show"><code class="prism language-python">train<span class="token punctuation">[</span><span class="token string">'Functional'</span><span class="token punctuation">]</span> <span class="token operator">=</span> train<span class="token punctuation">[</span><span class="token string">'Functional'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">'Typ'</span><span class="token punctuation">)</span>
test<span class="token punctuation">[</span><span class="token string">'Functional'</span><span class="token punctuation">]</span> <span class="token operator">=</span> test<span class="token punctuation">[</span><span class="token string">'Functional'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">'Typ'</span><span class="token punctuation">)</span>

train<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'Utilities'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
test<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'Utilities'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>
         <h5><a id="_344"></a>数字特征处理</h5>
         <h6><a id="__345"></a>· 补零</h6>
         <p>同样参照特征说明文档，对可能为零的特征，缺失值全部补零：</p>
         <pre class="set-code-show"><code class="prism language-python">zero_lists <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'GarageYrBlt'</span><span class="token punctuation">,</span> <span class="token string">'MasVnrArea'</span><span class="token punctuation">,</span> <span class="token string">'BsmtFullBath'</span><span class="token punctuation">,</span> <span class="token string">'BsmtHalfBath'</span><span class="token punctuation">,</span> <span class="token string">'BsmtFinSF1'</span><span class="token punctuation">,</span> <span class="token string">'BsmtFinSF2'</span><span class="token punctuation">,</span> <span class="token string">'BsmtUnfSF'</span><span class="token punctuation">,</span> <span class="token string">'GarageCars'</span><span class="token punctuation">,</span> <span class="token string">'GarageArea'</span><span class="token punctuation">,</span>
              <span class="token string">'TotalBsmtSF'</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> col <span class="token keyword">in</span> zero_lists<span class="token punctuation">:</span>
    train<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> train<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    test<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> test<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre>
         <h6><a id="__355"></a>· 补充中位数</h6>
         <p>对不能为零的特征，按’Neighborhood’分组，补充为同类’Neighborhood’中该特征的中位数：</p>
         <pre class="set-code-show"><code class="prism language-python">train<span class="token punctuation">[</span><span class="token string">'LotFrontage'</span><span class="token punctuation">]</span> <span class="token operator">=</span> train<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Neighborhood'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'LotFrontage'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>x<span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> ind <span class="token keyword">in</span> test<span class="token punctuation">[</span><span class="token string">'LotFrontage'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>test<span class="token punctuation">[</span><span class="token string">'LotFrontage'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token operator">==</span><span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">:</span>
    x <span class="token operator">=</span> test<span class="token punctuation">[</span><span class="token string">'Neighborhood'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>ind<span class="token punctuation">]</span>
    test<span class="token punctuation">[</span><span class="token string">'LotFrontage'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>ind<span class="token punctuation">]</span> <span class="token operator">=</span> train<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Neighborhood'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'LotFrontage'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
</code></pre>
         <p>注意测试数据中补充的是训练数据的中位数。<br> 最后检查下是否还存在缺失值：</p>
         <pre class="set-code-show"><code class="prism language-python">train<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
         <blockquote>
          <p>False</p>
         </blockquote>
         <pre class="set-code-show"><code class="prism language-python">test<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
         <blockquote>
          <p>False</p>
         </blockquote>
         <h4><a id="_379"></a>转换类别特征</h4>
         <p>类别特征不能直接输入模型，因此要对其进行编码，把它转换成数字。编码有两种方式，对于各个类别中可能存在顺序关系的，用LabelEncoder编码，对于不存在顺序关系的，用get_dummies。<br> 先处理存在顺序关系的这部分特征：</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#从存放类别特征的列表去掉'Utilities'</span>
cate_features<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'Utilities'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The number of categorical features:'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>cate_features<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
         <blockquote>
          <p>The number of categorical features: 42</p>
         </blockquote>
         <pre class="set-code-show"><code class="prism language-python"><span class="token keyword">for</span> col <span class="token keyword">in</span> cate_features<span class="token punctuation">:</span>
    train<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> train<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
    test<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> test<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
le_features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Street'</span><span class="token punctuation">,</span> <span class="token string">'Alley'</span><span class="token punctuation">,</span> <span class="token string">'LotShape'</span><span class="token punctuation">,</span> <span class="token string">'LandContour'</span><span class="token punctuation">,</span> <span class="token string">'LandSlope'</span><span class="token punctuation">,</span> <span class="token string">'HouseStyle'</span><span class="token punctuation">,</span> <span class="token string">'RoofMatl'</span><span class="token punctuation">,</span> <span class="token string">'Exterior1st'</span><span class="token punctuation">,</span> <span class="token string">'Exterior2nd'</span><span class="token punctuation">,</span> <span class="token string">'ExterQual'</span><span class="token punctuation">,</span> 
               <span class="token string">'ExterCond'</span><span class="token punctuation">,</span> <span class="token string">'Foundation'</span><span class="token punctuation">,</span> <span class="token string">'BsmtQual'</span><span class="token punctuation">,</span> <span class="token string">'BsmtCond'</span><span class="token punctuation">,</span> <span class="token string">'BsmtExposure'</span><span class="token punctuation">,</span> <span class="token string">'BsmtFinType1'</span><span class="token punctuation">,</span> <span class="token string">'BsmtFinType2'</span><span class="token punctuation">,</span> <span class="token string">'HeatingQC'</span><span class="token punctuation">,</span> <span class="token string">'CentralAir'</span><span class="token punctuation">,</span>
               <span class="token string">'KitchenQual'</span><span class="token punctuation">,</span> <span class="token string">'Functional'</span><span class="token punctuation">,</span> <span class="token string">'FireplaceQu'</span><span class="token punctuation">,</span> <span class="token string">'GarageFinish'</span><span class="token punctuation">,</span> <span class="token string">'GarageQual'</span><span class="token punctuation">,</span> <span class="token string">'GarageCond'</span><span class="token punctuation">,</span> <span class="token string">'PavedDrive'</span><span class="token punctuation">,</span> <span class="token string">'PoolQC'</span><span class="token punctuation">,</span> <span class="token string">'Fence'</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> col <span class="token keyword">in</span> le_features<span class="token punctuation">:</span>
    encoder <span class="token operator">=</span> LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>
    value_train <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>train<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    value_test <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>test<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    value_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>value_train <span class="token operator">|</span> value_test<span class="token punctuation">)</span>
    encoder<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>value_list<span class="token punctuation">)</span>
    train<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> encoder<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>train<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span>
    test<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> encoder<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>test<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
         <p>因为get_dummies需要对所有数据一起处理，所以放到最后。</p>
         <h4><a id="_406"></a>处理偏斜特征</h4>
         <p>先获得偏斜度大于0.5的特征，我们要对这一部分进行处理：</p>
         <pre class="set-code-show"><code class="prism language-python">skewness <span class="token operator">=</span> train<span class="token punctuation">[</span>num_features<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> skew<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
skewness <span class="token operator">=</span> skewness<span class="token punctuation">[</span>skewness<span class="token operator">&gt;</span><span class="token number">0.5</span><span class="token punctuation">]</span>
skew_features <span class="token operator">=</span> skewness<span class="token punctuation">.</span>index
skewness
</code></pre>
         <blockquote>
          <p>MiscVal 24.43<br> PoolArea 15.93<br> LotArea 12.56<br> 3SsnPorch 10.29<br> LowQualFinSF 9.00<br> KitchenAbvGr 4.48<br> BsmtFinSF2 4.25<br> ScreenPorch 4.11<br> BsmtHalfBath 4.10<br> EnclosedPorch 3.08<br> MasVnrArea 2.69<br> OpenPorchSF 2.34<br> LotFrontage 1.55<br> WoodDeckSF 1.54<br> MSSubClass 1.41<br> GrLivArea 1.01<br> BsmtUnfSF 0.92<br> 1stFlrSF 0.89<br> 2ndFlrSF 0.81<br> BsmtFinSF1 0.76<br> OverallCond 0.69<br> HalfBath 0.68<br> TotRmsAbvGrd 0.66<br> Fireplaces 0.63<br> BsmtFullBath 0.59<br> TotalBsmtSF 0.51<br> dtype: float64</p>
         </blockquote>
         <p>由于数据中可能存在许多没有处理的异常值，为了增强模型对异常值的刚度，我们采用Box Cox转换来处理偏斜数据：</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token keyword">for</span> col <span class="token keyword">in</span> skew_features<span class="token punctuation">:</span>
    lam <span class="token operator">=</span> stats<span class="token punctuation">.</span>boxcox_normmax<span class="token punctuation">(</span>train<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment">#+1是为了保证输入大于零</span>
    train<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> boxcox1p<span class="token punctuation">(</span>train<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">,</span> lam<span class="token punctuation">)</span>
    test<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> boxcox1p<span class="token punctuation">(</span>test<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">,</span> lam<span class="token punctuation">)</span>
</code></pre>
         <h4><a id="_450"></a>构建新的特征</h4>
         <p>怎么构建新的特征是解决数据科学问题的关键，特征构造的好，就能够提高模型的得分上限，而这一点需要敏锐的直觉和长期的经验。<br> 我们这里主要围绕与目标值相关度大的几个特征来构造新的特征：</p>
         <pre class="set-code-show"><code class="prism language-python">train<span class="token punctuation">[</span><span class="token string">'IsRemod'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span> 
train<span class="token punctuation">[</span><span class="token string">'IsRemod'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>loc<span class="token punctuation">[</span>train<span class="token punctuation">[</span><span class="token string">'YearBuilt'</span><span class="token punctuation">]</span><span class="token operator">==</span>train<span class="token punctuation">[</span><span class="token string">'YearRemodAdd'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment">#是否翻新(翻新：1， 未翻新：0)</span>
train<span class="token punctuation">[</span><span class="token string">'BltRemodDiff'</span><span class="token punctuation">]</span> <span class="token operator">=</span> train<span class="token punctuation">[</span><span class="token string">'YearRemodAdd'</span><span class="token punctuation">]</span> <span class="token operator">-</span> train<span class="token punctuation">[</span><span class="token string">'YearBuilt'</span><span class="token punctuation">]</span>  <span class="token comment">#翻新与建造的时间差（年）</span>
train<span class="token punctuation">[</span><span class="token string">'BsmtUnfRatio'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
train<span class="token punctuation">[</span><span class="token string">'BsmtUnfRatio'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>loc<span class="token punctuation">[</span>train<span class="token punctuation">[</span><span class="token string">'TotalBsmtSF'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> train<span class="token punctuation">[</span><span class="token string">'BsmtUnfSF'</span><span class="token punctuation">]</span> <span class="token operator">/</span> train<span class="token punctuation">[</span><span class="token string">'TotalBsmtSF'</span><span class="token punctuation">]</span>  <span class="token comment">#Basement未完成占总面积的比例</span>
train<span class="token punctuation">[</span><span class="token string">'TotalSF'</span><span class="token punctuation">]</span> <span class="token operator">=</span> train<span class="token punctuation">[</span><span class="token string">'TotalBsmtSF'</span><span class="token punctuation">]</span> <span class="token operator">+</span> train<span class="token punctuation">[</span><span class="token string">'1stFlrSF'</span><span class="token punctuation">]</span> <span class="token operator">+</span> train<span class="token punctuation">[</span><span class="token string">'2ndFlrSF'</span><span class="token punctuation">]</span>  <span class="token comment">#总面积</span>
<span class="token comment">#对测试集做同样的处理</span>
test<span class="token punctuation">[</span><span class="token string">'IsRemod'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span> 
test<span class="token punctuation">[</span><span class="token string">'IsRemod'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>loc<span class="token punctuation">[</span>test<span class="token punctuation">[</span><span class="token string">'YearBuilt'</span><span class="token punctuation">]</span><span class="token operator">==</span>test<span class="token punctuation">[</span><span class="token string">'YearRemodAdd'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment">#是否翻新(翻新：1， 未翻新：0)</span>
test<span class="token punctuation">[</span><span class="token string">'BltRemodDiff'</span><span class="token punctuation">]</span> <span class="token operator">=</span> test<span class="token punctuation">[</span><span class="token string">'YearRemodAdd'</span><span class="token punctuation">]</span> <span class="token operator">-</span> test<span class="token punctuation">[</span><span class="token string">'YearBuilt'</span><span class="token punctuation">]</span>  <span class="token comment">#翻新与建造的时间差（年）</span>
test<span class="token punctuation">[</span><span class="token string">'BsmtUnfRatio'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
test<span class="token punctuation">[</span><span class="token string">'BsmtUnfRatio'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>loc<span class="token punctuation">[</span>test<span class="token punctuation">[</span><span class="token string">'TotalBsmtSF'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> test<span class="token punctuation">[</span><span class="token string">'BsmtUnfSF'</span><span class="token punctuation">]</span> <span class="token operator">/</span> test<span class="token punctuation">[</span><span class="token string">'TotalBsmtSF'</span><span class="token punctuation">]</span>  <span class="token comment">#Basement未完成占总面积的比例</span>
test<span class="token punctuation">[</span><span class="token string">'TotalSF'</span><span class="token punctuation">]</span> <span class="token operator">=</span> test<span class="token punctuation">[</span><span class="token string">'TotalBsmtSF'</span><span class="token punctuation">]</span> <span class="token operator">+</span> test<span class="token punctuation">[</span><span class="token string">'1stFlrSF'</span><span class="token punctuation">]</span> <span class="token operator">+</span> test<span class="token punctuation">[</span><span class="token string">'2ndFlrSF'</span><span class="token punctuation">]</span>  <span class="token comment">#总面积</span>
</code></pre>
         <h4><a id="_468"></a>处理其余的类别特征</h4>
         <p>先获得要处理的特征：</p>
         <pre class="set-code-show"><code class="prism language-python">dummy_features <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>cate_features<span class="token punctuation">)</span><span class="token punctuation">.</span>difference<span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>le_features<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
dummy_features
</code></pre>
         <blockquote>
          <p>[‘SaleCondition’,<br> ‘LotConfig’,<br> ‘MSZoning’,<br> ‘GarageType’,<br> ‘RoofStyle’,<br> ‘BldgType’,<br> ‘MasVnrType’,<br> ‘Condition1’,<br> ‘Neighborhood’,<br> ‘Electrical’,<br> ‘MiscFeature’,<br> ‘SaleType’,<br> ‘Condition2’,<br> ‘Heating’]</p>
         </blockquote>
         <p>把训练数据和测试数据连接起来一起处理（因为独热编码不会产生数据泄露，所以可以放在一起处理）：</p>
         <pre class="set-code-show"><code class="prism language-python">all_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">(</span>train<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'SalePrice'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
all_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span>all_data<span class="token punctuation">,</span> drop_first<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment">#注意独热编码生成的时候要去掉一个维度，保证剩下的变量都是相互独立的</span>
</code></pre>
         <h4><a id="_495"></a>保存处理后的训练数据和测试数据</h4>
         <p>数据处理的代码和模型预测的代码最好是分成两个文件，保存处理后的数据，这样处理后的数据可以随时读入模型中进行预测，不用每次测试新的模型的时候都把前面数据处理的代码重新跑一遍。<br> 把连接起来的所有数据再拆分回训练集和测试集：</p>
         <pre class="set-code-show"><code class="prism language-python">trainset <span class="token operator">=</span> all_data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">1458</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> train<span class="token punctuation">[</span><span class="token string">'SalePrice'</span><span class="token punctuation">]</span>
trainset<span class="token punctuation">[</span><span class="token string">'SalePrice'</span><span class="token punctuation">]</span> <span class="token operator">=</span> y<span class="token punctuation">.</span>values
testset <span class="token operator">=</span> all_data<span class="token punctuation">[</span><span class="token number">1458</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The shape of training data:'</span><span class="token punctuation">,</span> trainset<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The shape of testing data:'</span><span class="token punctuation">,</span> testset<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre>
         <blockquote>
          <p>The shape of training data: (1458, 160)<br> The shape of testing data: (1459, 159)</p>
         </blockquote>
         <p>保存处理后的数据：</p>
         <pre class="set-code-show"><code class="prism language-python">trainset<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'train_data.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
testset<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'test_data.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre>
         <h2><a id="3_514"></a>3.模型预测</h2>
         <h3><a id="_515"></a>导入所需的库</h3>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#基础</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> time

<span class="token comment">#绘图</span>
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token operator">%</span>matplotlib inline

<span class="token comment">#模型</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> Lasso<span class="token punctuation">,</span> LassoCV<span class="token punctuation">,</span> ElasticNet<span class="token punctuation">,</span> ElasticNetCV<span class="token punctuation">,</span> Ridge<span class="token punctuation">,</span> RidgeCV
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestRegressor<span class="token punctuation">,</span> GradientBoostingRegressor<span class="token punctuation">,</span> StackingRegressor
<span class="token keyword">from</span> mlxtend<span class="token punctuation">.</span>regressor <span class="token keyword">import</span> StackingCVRegressor
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVR
<span class="token keyword">import</span> lightgbm <span class="token keyword">as</span> lgb
<span class="token keyword">import</span> xgboost <span class="token keyword">as</span> xgb

<span class="token comment">#模型相关</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>pipeline <span class="token keyword">import</span> make_pipeline
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> RobustScaler
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> KFold<span class="token punctuation">,</span> cross_val_score
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_squared_error

<span class="token comment">#忽略警告</span>
<span class="token keyword">import</span> warnings
<span class="token keyword">def</span> <span class="token function">ignore_warn</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
warnings<span class="token punctuation">.</span>warn <span class="token operator">=</span> ignore_warn
</code></pre>
         <h3><a id="_547"></a>读取数据，处理目标值</h3>
         <p>先读取训练集和测试集：</p>
         <pre class="set-code-show"><code class="prism language-python">train <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'train_data.csv'</span><span class="token punctuation">)</span>
test <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'test_data.csv'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The shape of training data:'</span><span class="token punctuation">,</span> train<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The shape of testing data:'</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre>
         <p>在数据探索的时候，我们发现目标值是右偏斜的，所以对目标值取对数，将其处理成近似正态分布。<br> 查看目标值的分布：</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#查看目标值的斜度和峰度</span>
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>stats <span class="token keyword">import</span> skew<span class="token punctuation">,</span> kurtosis<span class="token punctuation">,</span> norm

y <span class="token operator">=</span> train<span class="token punctuation">[</span><span class="token string">'SalePrice'</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Skewness of target:'</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>skew<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'kurtosis of target:'</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>kurtosis<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sns<span class="token punctuation">.</span>distplot<span class="token punctuation">(</span>y<span class="token punctuation">,</span> fit<span class="token operator">=</span>norm<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
         <blockquote>
          <p>Skewness of target: 1.8812964895244009<br> kurtosis of target: 6.523066888485879</p>
         </blockquote>
         <p><img src="http://toolman.ddnsfree.com:8585/cn/csdnimg/i-blog/blog_migrate/0bf67ea0b995424d29f2cf18caa13bc3.png#pic_center" alt="SalePrice分布"><br> 明显右偏，取对数：</p>
         <pre class="set-code-show"><code class="prism language-python">y <span class="token operator">=</span> np<span class="token punctuation">.</span>log1p<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Skewness of target:'</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>skew<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'kurtosis of target:'</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>kurtosis<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sns<span class="token punctuation">.</span>distplot<span class="token punctuation">(</span>y<span class="token punctuation">,</span> fit<span class="token operator">=</span>norm<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
         <blockquote>
          <p>Skewness of target: 0.12157976050304879<br> kurtosis of target: 0.8047507917418972</p>
         </blockquote>
         <p><img src="http://toolman.ddnsfree.com:8585/cn/csdnimg/i-blog/blog_migrate/ca97236d81f6b8b4f41a6facc7171b08.png#pic_center" alt="处理后的SalePrice"><br> 此时目标值已经接近正态分布了。</p>
         <h3><a id="_582"></a>定义交叉验证策略及评估方法</h3>
         <p>模型的验证有两种方法：留出法和交叉验证。因为训练集的数据较少，所以采用十折交叉验证：</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#采用十折交叉验证</span>
n_folds <span class="token operator">=</span> <span class="token number">10</span>

<span class="token keyword">def</span> <span class="token function">rmse_cv</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">:</span>
  kf <span class="token operator">=</span> KFold<span class="token punctuation">(</span>n_folds<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
  rmse <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token operator">-</span>cross_val_score<span class="token punctuation">(</span>model<span class="token punctuation">,</span> train<span class="token punctuation">.</span>values<span class="token punctuation">,</span> y<span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'neg_mean_squared_error'</span><span class="token punctuation">,</span> cv<span class="token operator">=</span>kf<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span><span class="token punctuation">(</span>rmse<span class="token punctuation">)</span>
</code></pre>
         <h3><a id="_593"></a>单个模型参数设置</h3>
         <p>这里选择回归问题常用的六个模型：<br> · Lasso<br> · ElasticNet<br> · Ridge<br> · Gradient Boosting<br> · LightGBM<br> · XGBoost<br> kaggle的比赛中单个模型能做好，那么模型融合后的效果就不会差，因此，要反复地调参，找到模型的最佳参数。以下给出的参数设置是已经经过调参得到的，关于调参网上有很多经验分享，这里不另行赘述，调参部分的代码我也放在github中了。</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#Lasso</span>
lasso_alpha <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.00005</span><span class="token punctuation">,</span> <span class="token number">0.0001</span><span class="token punctuation">,</span> <span class="token number">0.0002</span><span class="token punctuation">,</span> <span class="token number">0.0005</span><span class="token punctuation">,</span> <span class="token number">0.001</span><span class="token punctuation">,</span> <span class="token number">0.002</span><span class="token punctuation">,</span> <span class="token number">0.005</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.02</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span>
lasso <span class="token operator">=</span> make_pipeline<span class="token punctuation">(</span>RobustScaler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> LassoCV<span class="token punctuation">(</span>alphas<span class="token operator">=</span>lasso_alpha<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#ElasticNet</span>
enet_beta <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span>
enet_alpha <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.00005</span><span class="token punctuation">,</span> <span class="token number">0.0001</span><span class="token punctuation">,</span> <span class="token number">0.0002</span><span class="token punctuation">,</span> <span class="token number">0.0005</span><span class="token punctuation">,</span> <span class="token number">0.001</span><span class="token punctuation">,</span> <span class="token number">0.002</span><span class="token punctuation">,</span> <span class="token number">0.005</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">]</span>
ENet <span class="token operator">=</span> make_pipeline<span class="token punctuation">(</span>RobustScaler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ElasticNetCV<span class="token punctuation">(</span>l1_ratio<span class="token operator">=</span>enet_beta<span class="token punctuation">,</span> alphas<span class="token operator">=</span>enet_alpha<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#Ridge</span>
rid_alpha <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.00005</span><span class="token punctuation">,</span> <span class="token number">0.0001</span><span class="token punctuation">,</span> <span class="token number">0.0002</span><span class="token punctuation">,</span> <span class="token number">0.0005</span><span class="token punctuation">,</span> <span class="token number">0.001</span><span class="token punctuation">,</span> <span class="token number">0.002</span><span class="token punctuation">,</span> <span class="token number">0.005</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.02</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span>
rid <span class="token operator">=</span> make_pipeline<span class="token punctuation">(</span>RobustScaler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> RidgeCV<span class="token punctuation">(</span>alphas<span class="token operator">=</span>rid_alpha<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#Gradient Boosting</span>
gbr_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'loss'</span><span class="token punctuation">:</span> <span class="token string">'huber'</span><span class="token punctuation">,</span>
      <span class="token string">'criterion'</span><span class="token punctuation">:</span> <span class="token string">'mse'</span><span class="token punctuation">,</span> 
      <span class="token string">'learning_rate'</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
      <span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token number">600</span><span class="token punctuation">,</span> 
      <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token string">'subsample'</span><span class="token punctuation">:</span> <span class="token number">0.6</span><span class="token punctuation">,</span>
      <span class="token string">'min_samples_split'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
      <span class="token string">'min_samples_leaf'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token string">'max_features'</span><span class="token punctuation">:</span> <span class="token number">0.6</span><span class="token punctuation">,</span>
      <span class="token string">'random_state'</span><span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
      <span class="token string">'alpha'</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">}</span>
gbr <span class="token operator">=</span> GradientBoostingRegressor<span class="token punctuation">(</span><span class="token operator">**</span>gbr_params<span class="token punctuation">)</span>

<span class="token comment">#LightGBM</span>
lgbr_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'learning_rate'</span><span class="token punctuation">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span>
      <span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token number">1850</span><span class="token punctuation">,</span> 
      <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token string">'num_leaves'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
      <span class="token string">'subsample'</span><span class="token punctuation">:</span> <span class="token number">0.6</span><span class="token punctuation">,</span>
      <span class="token string">'colsample_bytree'</span><span class="token punctuation">:</span> <span class="token number">0.6</span><span class="token punctuation">,</span>
      <span class="token string">'min_child_weight'</span><span class="token punctuation">:</span> <span class="token number">0.001</span><span class="token punctuation">,</span>
      <span class="token string">'min_child_samples'</span><span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
      <span class="token string">'random_state'</span><span class="token punctuation">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
      <span class="token string">'reg_alpha'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token string">'reg_lambda'</span><span class="token punctuation">:</span> <span class="token number">0.05</span><span class="token punctuation">}</span>
lgbr <span class="token operator">=</span> lgb<span class="token punctuation">.</span>LGBMRegressor<span class="token punctuation">(</span><span class="token operator">**</span>lgbr_params<span class="token punctuation">)</span>

<span class="token comment">#XGBoost</span>
xgbr_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'learning_rate'</span><span class="token punctuation">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span>
      <span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span> 
      <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token string">'subsample'</span><span class="token punctuation">:</span> <span class="token number">0.6</span><span class="token punctuation">,</span>
      <span class="token string">'colsample_bytree'</span><span class="token punctuation">:</span> <span class="token number">0.7</span><span class="token punctuation">,</span>
      <span class="token string">'min_child_weight'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token string">'seed'</span><span class="token punctuation">:</span> <span class="token number">52</span><span class="token punctuation">,</span>
      <span class="token string">'gamma'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token string">'reg_alpha'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token string">'reg_lambda'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
xgbr <span class="token operator">=</span> xgb<span class="token punctuation">.</span>XGBRegressor<span class="token punctuation">(</span><span class="token operator">**</span>xgbr_params<span class="token punctuation">)</span>
</code></pre>
         <h3><a id="_658"></a>单个模型评估</h3>
         <p>用之前设定的评估方法进行评估：</p>
         <pre class="set-code-show"><code class="prism language-python">models_name <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Lasso'</span><span class="token punctuation">,</span> <span class="token string">'ElasticNet'</span><span class="token punctuation">,</span> <span class="token string">'Ridge'</span><span class="token punctuation">,</span> <span class="token string">'Gradient Boosting'</span><span class="token punctuation">,</span> <span class="token string">'LightGBM'</span><span class="token punctuation">,</span> <span class="token string">'XGBoost'</span><span class="token punctuation">]</span>
models <span class="token operator">=</span> <span class="token punctuation">[</span>lasso<span class="token punctuation">,</span> ENet<span class="token punctuation">,</span> rid<span class="token punctuation">,</span> gbr<span class="token punctuation">,</span> lgbr<span class="token punctuation">,</span> xgbr<span class="token punctuation">]</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> model <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>models<span class="token punctuation">)</span><span class="token punctuation">:</span>
  score <span class="token operator">=</span> rmse_cv<span class="token punctuation">(</span>model<span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{} score: {}({})'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>models_name<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> score<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> score<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
         <blockquote>
          <p>Lasso score: 0.11068147519566576(0.0073942264704033155)<br> ElasticNet score: 0.11091904371233648(0.007532173448331412)<br> Ridge score: 0.11119303368441777(0.00758400106291327)<br> Gradient Boosting score: 0.11865538871859024(0.009497984510023386)<br> LightGBM score: 0.118318792967013(0.010364808635531306)</p>
         </blockquote>
         <h3><a id="Stacking_673"></a>Stacking</h3>
         <p>模型融合有Stacking和Blending两种方法，可以直接采用mlxtend库提供的StackingCVRegressor构建Stacking模型：</p>
         <pre class="set-code-show"><code class="prism language-python">stack_model <span class="token operator">=</span> StackingCVRegressor<span class="token punctuation">(</span>regressors<span class="token operator">=</span><span class="token punctuation">(</span>lasso<span class="token punctuation">,</span> ENet<span class="token punctuation">,</span> rid<span class="token punctuation">,</span> gbr<span class="token punctuation">,</span> lgbr<span class="token punctuation">,</span> xgbr<span class="token punctuation">)</span><span class="token punctuation">,</span> meta_regressor<span class="token operator">=</span>lasso<span class="token punctuation">,</span> use_features_in_secondary<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>
         <h3><a id="_679"></a>在整个训练集上训练各个模型</h3>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#Lasso</span>
lasso_trained <span class="token operator">=</span> lasso<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#ElasticNet</span>
ENet_trained <span class="token operator">=</span> ENet<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#Ridge</span>
rid_trained <span class="token operator">=</span> rid<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#Gradient Boosting</span>
gbr_trained <span class="token operator">=</span> gbr<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#LightGBM</span>
lgbr_trained <span class="token operator">=</span> lgbr<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#XGBoost</span>
xgbr_trained <span class="token operator">=</span> xgbr<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#Stacking</span>
stack_model_trained <span class="token operator">=</span> stack_model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
         <h3><a id="_702"></a>评估各个模型在训练集上的表现</h3>
         <p>先定义评估方法，采用kaggle规定的评估方法：</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">rmse</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> y_preds<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">return</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>mean_squared_error<span class="token punctuation">(</span>y<span class="token punctuation">,</span> y_preds<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
         <p>评估模型：</p>
         <pre class="set-code-show"><code class="prism language-python">models<span class="token punctuation">.</span>append<span class="token punctuation">(</span>stack_model<span class="token punctuation">)</span>
models_name<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'Stacking_model'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> model <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>models<span class="token punctuation">)</span><span class="token punctuation">:</span>
  y_preds <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train<span class="token punctuation">)</span><span class="token punctuation">)</span>
  model_score <span class="token operator">=</span> rmse<span class="token punctuation">(</span>y<span class="token punctuation">,</span> y_preds<span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'RMSE of {}: {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>models_name<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> model_score<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
         <blockquote>
          <p>RMSE of Lasso: 0.0989275731446597<br> RMSE of ElasticNet: 0.09866027051143429<br> RMSE of Ridge: 0.09681908262749463<br> RMSE of Gradient Boosting: 0.06583064311955181<br> RMSE of LightGBM: 0.0641626832182992<br> RMSE of XGBoost: 0.02286417135304461<br> RMSE of Stacking_model: 0.09431153828814741</p>
         </blockquote>
         <h3><a id="_725"></a>提交预测结果</h3>
         <pre class="set-code-show"><code class="prism language-python">sample_submission <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'sample_submission.csv'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> model <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>models<span class="token punctuation">)</span><span class="token punctuation">:</span>
  preds <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">)</span>
  submission <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Id'</span><span class="token punctuation">:</span> sample_submission<span class="token punctuation">[</span><span class="token string">'Id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'SalePrice'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>expm1<span class="token punctuation">(</span>preds<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  submission<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'House_Price_submission_'</span><span class="token operator">+</span>models_name<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'_optimation.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{} finished.'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>models_name<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
         <blockquote>
          <p>Lasso finished.<br> ElasticNet finished.<br> Ridge finished.<br> Gradient Boosting finished.<br> LightGBM finished.<br> XGBoost finished.<br> Stacking_model finished.</p>
         </blockquote>
         <h3><a id="Blending_742"></a>Blending</h3>
         <p>采用两种比较简单的融合方法：均值融合和加权融合。<br> 均值融合：</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#均值融合</span>
preds_in_train <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>models<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> model <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>models<span class="token punctuation">)</span><span class="token punctuation">:</span>
  preds_in_train<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train<span class="token punctuation">)</span><span class="token punctuation">)</span>
average_preds_in_train <span class="token operator">=</span> preds_in_train<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
average_score <span class="token operator">=</span> rmse<span class="token punctuation">(</span>y<span class="token punctuation">,</span> average_preds_in_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'RMSE of average model on training data:'</span><span class="token punctuation">,</span> average_score<span class="token punctuation">)</span>
</code></pre>
         <blockquote>
          <p>RMSE of average model on training data: 0.07286858974899155</p>
         </blockquote>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#提交均值融合预测结果</span>
preds_in_test <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>models<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> model <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>models<span class="token punctuation">)</span><span class="token punctuation">:</span>
  preds_in_test<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">)</span>
average_preds_in_test <span class="token operator">=</span> preds_in_test<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

average_submission <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Id'</span><span class="token punctuation">:</span> sample_submission<span class="token punctuation">[</span><span class="token string">'Id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'SalePrice'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>expm1<span class="token punctuation">(</span>average_preds_in_test<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
average_submission<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'House_Price_submission_average_model_optimation.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre>
         <p>加权融合，根据各模型的得分取合适的权重：</p>
         <pre class="set-code-show"><code class="prism language-python">model_weights <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.15</span><span class="token punctuation">,</span> <span class="token number">0.12</span><span class="token punctuation">,</span> <span class="token number">0.08</span><span class="token punctuation">,</span> <span class="token number">0.08</span><span class="token punctuation">,</span> <span class="token number">0.12</span><span class="token punctuation">,</span> <span class="token number">0.15</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">]</span>
weight_preds_in_train <span class="token operator">=</span> np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>preds_in_train<span class="token punctuation">,</span> model_weights<span class="token punctuation">)</span>

weight_score <span class="token operator">=</span> rmse<span class="token punctuation">(</span>y<span class="token punctuation">,</span> weight_preds_in_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'RMSE of weight model on training data:'</span><span class="token punctuation">,</span> weight_score<span class="token punctuation">)</span>
</code></pre>
         <blockquote>
          <p>RMSE of weight model on training data: 0.07525884061133567</p>
         </blockquote>
         <p>可以看到，加权融合比均值融合有更好的表现。</p>
         <pre class="set-code-show"><code class="prism language-python"><span class="token comment">#提交权值融合预测结果</span>
weight_preds_in_test <span class="token operator">=</span> np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>preds_in_test<span class="token punctuation">,</span> model_weights<span class="token punctuation">)</span>

weight_submission <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Id'</span><span class="token punctuation">:</span> sample_submission<span class="token punctuation">[</span><span class="token string">'Id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'SalePrice'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>expm1<span class="token punctuation">(</span>weight_preds_in_test<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
weight_submission<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'House_Price_submission_weight_model_optimation.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre>
         <p>可以把最后的结果保存起来，以便以后有更好的想法对这些结果进一步处理，提高得分。<br> 提交到kaggle得到的Private Score如下图：<br> <img src="http://toolman.ddnsfree.com:8585/cn/csdnimg/i-blog/blog_migrate/ba6a6aeff21540035f4011ad32133e89.png#pic_center" alt="模型得分"></p></div>
        <link href="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blogv2/dist/mdeditor/css/editerView/markdown_views-f23dff6052.css" rel="stylesheet">
        <link href="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blogv2/dist/mdeditor/css/style-e504d6a974.css" rel="stylesheet"></div>
      </article></div>
    </main></div><div class="recommend-right align-items-stretch clearfix" id="rightAside" data-type="recommend"></div></div>
  <link rel="stylesheet" href="http://toolman.ddnsfree.com:8585/cn/csdnimg/g/lib/cboxEditor/1.1.6/embed-editor.min.css">
  <link rel="stylesheet" href="http://toolman.ddnsfree.com:8585/cn/csdnimg/release/blog_editor_html/release1.6.12/ckeditor/plugins/codesnippet/lib/highlight/styles/atom-one-light.css">
 </body>
</html>